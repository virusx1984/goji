##### `business_units` (Business Units / 事业部表)
**作用：** 定义公司最高级别的业务单元。
| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **name** | `VARCHAR` | BU名称 (如 "消费电子BU") | Not Null, Unique |
| **desc** | `VARCHAR` | BU描述 | |

##### `legal_entities` (公司法人表)
**作用：** 存储所有独立法人公司的信息。
| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **name** | `VARCHAR` | 公司法人全称 | Not Null, Unique |
| **tax_id** | `VARCHAR` | 统一社会信用代码/税号 | Unique, Indexed |
| **address** | `VARCHAR` | 注册地址 | |
| **legal_rep** | `VARCHAR` | 法定代表人 | |
| **...** | ... | 其他法务/财务信息 | |

#### `factory_clusters` (工厂集群表)
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **bu_id** | `INTEGER` | **【新】** 关联到所属的BU | 外键, 关联 `bus.id`, Not Null |
| **legal_entity_id** | `INTEGER` | **【修正】**`entity_id` -> `legal_entity_id`，更明确 | 外键, 关联 `legal_entities.id`, Not Null |
| **name** | `VARCHAR` | 集群名称 (如 "华南生产集群") | Not Null, Unique |

#### `plants` (工厂/厂房表)
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **cluster_id**| `INTEGER` | 关联到所属的工厂集群 | 外键, 关联 `factory_clusters.id` |
| **name** | `VARCHAR` | 工厂名称 | Not Null |
| **location** | `VARCHAR` | 工厂地址 | |

#### `products` (产品表)
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 厂内唯一主键 | Primary Key |
| **status** | `VARCHAR`| **【新】**产品状态 | Not Null, e.g., 'PLANNING', 'ACTIVE', 'EOL' |
| **ref_product_id** | `INTEGER`| **【新】**参考产品ID | 外键, 自关联到 `products.id`, **可为空** |
| **cust_id** | `INTEGER` | **【修正】** 增加此关键外键，关联到客户 | 外键, 关联 `customers.id`, Not Null |
| **cust_part_num** | `VARCHAR`| **【缩写】**客户提供的料号 | Not Null, Indexed |
| **cust_ver** | `VARCHAR` | **【缩写】**客户提供的版本号 | Not Null |
| **desc** | `VARCHAR` | **【缩写】**产品描述 | |
| **pcs_per_strip**| `INTEGER` | (UOM) 每 strip 包含多少 pcs | |
| **strips_per_panel**|`INTEGER` | (UOM) 每 panel 包含多少 strip | |
| **created_at** | `TIMESTAMP` | 创建时间 | |
| **updated_at** | `TIMESTAMP` | 更新时间 | |


#### `work_centers` (工作中心/设备表)
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **plant_id** | `INTEGER` | 关联到所属的工厂 | 外键, 关联 `plants.id`, Not Null |
| **name** | `VARCHAR` | 工作中心名称 | Not Null, Unique |
| **desc** | `VARCHAR` | **【修正】** 增加描述字段，保持一致性 | |
| **daily_avail_sec**| `INTEGER` | **【缩写】**每日计划可用时间（秒） | Not Null |
| **oee_pct** | `DECIMAL` | **【缩写】**设备综合效率 (0.00-1.00) | Not Null |

#### `equipments` (设备主档表)
**作用：** 记录每一台物理设备的资产信息。
| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **group_id** | `INTEGER` | **【修改】** 关联到所属的设备组 | 外键, 关联 `equipment_groups.id`, **可为空** |
| **asset_tag**| `VARCHAR` | **资产编号** | Not Null, Unique |
| **serial_num**| `VARCHAR` | 设备序列号 | Unique |
| **model_num** | `VARCHAR` | 设备型号 | |
| **sup_loc_id**| `INTEGER` | **【移入】**采购供应商地点 | 外键, 关联 `supplier_locations.id` |
| **mfg_id** | `INTEGER` | **【移入】**品牌制造商 | 外键, 关联 `suppliers.id` |
| **purchase_date**| `DATE` | 采购日期 | |
| **install_date**| `DATE` | 安装日期 | |
| **status** | `VARCHAR` | 设备状态 | e.g., 'Active', 'Maintenance', 'Retired' |
| **...** | ... | 其他资产属性 | |

#### `equipment_groups` (设备组主档表)
**作用：** 定义一个由多个物理设备组成的逻辑功能单元。
| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **plant_id** | `INTEGER` | 关联到所属的工厂 | 外键, 关联 `plants.id`, Not Null |
| **name** | `VARCHAR` | 设备组名称 (如 "SMT线-01", "曝光机组-A") | Not Null, Unique |
| **desc** | `VARCHAR` | 设备组描述 | |
| **status** | `VARCHAR` | 设备组状态 | e.g., 'Active', 'Inactive' |

#### `work_center_equipments` (工作中心设备关联表)
**作用：** 建立“调度岗位”和“物理设备”之间的灵活关系。
| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **wc_id** | `INTEGER` | 关联到工作中心 | 外键, 关联 `work_centers.id` |
| **equipment_id**| `INTEGER` | 关联到具体设备 | 外键, 关联 `equipment.id` |

#### `routings` (工艺路线主表)
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **status** | `VARCHAR` | **【新】**工艺路线状态 | Not Null, e.g., 'PLANNING', 'ACTIVE', 'ARCHIVED' |
| **product_id**| `INTEGER` | 关联到产品 | 外键, 关联 `products.id` |
| **plant_id** | `INTEGER` | 此工艺路线所属的工厂 | 外键, 关联 `plants.id`, Not Null |
| **int_part_num**| `VARCHAR` | **【缩写】**厂内料号 | Not Null, Indexed |
| **int_ver** | `VARCHAR` | **【缩写】**厂内版本 | Not Null |
| **is_default**| `BOOLEAN` | 是否为默认生产版本 | Not Null, Default: False |
| **is_active** | `BOOLEAN` | 此工艺路线是否有效 | Not Null, Default: True |

#### `operations` (标准工序表)
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **code** | `VARCHAR` | **【新】**工序代码 (来自`pc`) | e.g., 'A001', 'A011' |
| **name** | `VARCHAR` | 工序名称 (来自`pcn`) | e.g., '下料', '裁板' |
| **desc** | `VARCHAR` | 工序详细描述 | |

#### `routing_operations` (工艺路线工序明细表)
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **routing_id**| `INTEGER` | 关联到工艺路线 | 外键, 关联 `routings.id` |
| **op_id** | `INTEGER` | **【缩写】**关联到标准工序 | 外键, 关联 `operations.id` |
| **step_num** | `INTEGER` | **【缩写】**工序号，用于排序 (10, 20...) | Not Null |
| **semi_pn** | `VARCHAR` | **【新】**此工序产出的半成品料号 (来自`semiPN`) | 作为文本信息记录，可为空 |
| **notes** | `TEXT` | **【新】**工艺备注 (来自`comments`数组) | 将所有备注信息序列化后存为大文本 |
| **layer_def_id** | `INTEGER` | **【新】**此工序操作/产出的层别ID | 外键, 关联 `layer_definitions.id`, 可为空 |
| **workpiece_pcs**| `DECIMAL` | **【新】**工作数量 (来自`workingPcs`) | |
| **workpiece_len**| `DECIMAL` | **【新】**工作长度 (来自`len`) | |
| **workpiece_width**| `DECIMAL` | **【新】**工作宽度 (来自`width`) | |


### `layer_definitions` (层别定义主表)
**作用：** 作为所有“层别组合”的字典或主数据，确保每个层别（无论是基板、半成品还是成品）都有唯一的ID和代码。
| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **layer_code** | `VARCHAR` | 层别代码 | Not Null, Unique, Indexed |
| **layer_name** | `VARCHAR` | 层别名称 | e.g., '内层L5-L6(基板层)' |
| **desc** | `VARCHAR` | 详细描述 | |

### `layer_structures` (叠构关系表)
**作用：** 描述某个特定产品内部，各个层别之间的父子层级（压合）关系，并定义其在叠构树中的位置和重要性。
| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **product_id**| `INTEGER` | 此结构属于哪个产品 | 外键, 关联 `products.id`, Not Null |
| **parent_layer_id**| `INTEGER` | **父层级**的ID | 外键, 关联 `layer_definitions.id`, Not Null |
| **child_layer_id** | `INTEGER` | **子层级**的ID | 外键, 关联 `layer_definitions.id`, **在一个产品内必须唯一**, Not Null |
| **is_primary_branch**| `BOOLEAN` | 是否为主干分支 | Not Null, Default: False |
| **level** | `INTEGER` | 层级深度 (成品为0) | Not Null |

#### `operation_resources` (工序可用资源表)
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **routing_op_id** | `INTEGER` | **【缩写】**关联到具体工序步骤 | 外键, 关联 `routing_operations.id` |
| **wc_id** | `INTEGER` | **【缩写】**关联到可用设备 | 外键, 关联 `work_centers.id` |
| **setup_time_sec**| `INTEGER` | **【缩写】**准备/换模时间（秒） | Not Null |
| **raw_run_time_val** | `DECIMAL` | **【缩写】**原始测量时间值 | |
| **raw_run_time_uom**| `VARCHAR` | **【缩写】**原始测量单位 ('panel'...) | |
| **items_per_raw_uom**| `INTEGER` | **【缩写】**UOM换算率 (pcs/UOM) | |
| **run_time_sec_per_pc** | `DECIMAL` | **【缩写】【核心】**标准化后的单件时间(秒/pcs) | **规划引擎使用此字段** |
| **pref_level** | `INTEGER` | **【缩写】**优先级 (1=首选, 2=备选) | Not Null |
| **is_active** | `BOOLEAN` | 是否激活此选项 | Not Null |

### `materials` (物料主档表)

**作用：** 作为所有“物品”（包括原材料、半成品、成品）的中央资料库，记录它们不随使用场景而改变的固有属性。

| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **part_num** | `VARCHAR` | 物料料号 | Not Null, Unique, Indexed |
| **name** | `VARCHAR` | 物料名称 | |
| **desc** | `VARCHAR` | 物料描述/规格 | |
| **uom** | `VARCHAR` | **基础库存单位** (Unit of Measure) | Not Null, (e.g., 'pcs', 'kg', 'm', 'sh') |
| **length** | `DECIMAL` | **【新增】**标准长度 (固有属性) | 可为空 |
| **width** | `DECIMAL` | **【新增】**标准宽度 (固有属性) | 可为空 |
| **thickness** | `DECIMAL` | **【新增】**标准厚度 (固有属性) | 可为空 |
| **type** | `VARCHAR` | **【新增】**物料类型 | 'RAW'(原材料), 'SEMI'(半成品), 'FINISHED'(成品) |
| **created_at**| `TIMESTAMP` | 创建时间 | |
| **updated_at**| `TIMESTAMP` | 更新时间 | |

##### `alternate_materials` (替代物料表)
| 字段名 | 说明 |
| :--- | :--- |
| id | 主键 |
| **bom\_item\_id** | **【核心】** 关联到`bom_items`中的主物料记录 |
| **alt\_material\_id** | **替代料**的ID (关联到 `materials.id`) |
| **priority** | 优先级 (1=首选替代, 2=次选替代) |
| **...** | 其他关系属性 (如: 替代比例, 备注) |

### `bom_items` (工艺物料清单表)

**作用：** 精确定义在某个工艺步骤中，消耗了什么物料，以及消耗的**定额 (Rate)**。这张表是计算物料需求计划(MRP)的核心依据。

| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **routing_op_id** | `INTEGER` | 关联到具体工序步骤 | 外键, 关联 `routing_operations.id` |
| **material_id**| `INTEGER` | 关联到**消耗的物料**(投入物) | 外键, 关联 `materials.id` |
| **quantity** | `DECIMAL` | **【分子】**投入物的数量 | Not Null |
| **uom** | `VARCHAR` | **【分子】**投入物的单位 | Not Null |
| **base_qty** | `DECIMAL` | **【分母】**产出品的基准数量 | **【新增】** Not Null, Default: 1 |
| **base_uom** | `VARCHAR` | **【分母】**产出品的基准单位 | **【新增】** Not Null, Default: 'pcs' |
| **multiplier**| `DECIMAL` | 倍数/系数 | Not Null, Default: 1 |
| **scrap_pct**| `DECIMAL` | 损耗率 (%) | Not Null, Default: 0 |
| **notes** | `VARCHAR`| **【新增】**关于此物料消耗的特别备注 | 可为空 |

#### `customers` (客户主档/付款方)
**作用：** 存储客户的法人/集团信息，即“Bill-To”信息。
| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **code** | `VARCHAR` | 客户代码 | Not Null, Unique, Indexed |
| **name** | `VARCHAR` | 客户法人/集团全称 | Not Null |
| **...** | ... | 其他集团层面的财务信息 (如付款条件) | |

#### `customer_locations` (客户地点/交货地表)
**作用：** 存储一个客户法人实体下的所有物理交货地点信息，即“Ship-To”信息。
| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **cust_id** | `INTEGER` | 关联到客户主档 | 外键, 关联 `customers.id`, Not Null |
| **loc_name** | `VARCHAR` | 地点名称 (如 "郑州保税区仓库") | Not Null |
| **loc_code** | `VARCHAR` | 地点代码 (可选, 客户方提供的地点ID) | |
| **address** | `VARCHAR` | 详细交货地址 | |
| **contact_person**| `VARCHAR` | 该地点的收货联系人 | |
| **phone** | `VARCHAR` | 该地点的联系电话 | |
| **is_default** | `BOOLEAN` | 是否为该客户的默认收货地址 | Not Null, Default: False |

#### `suppliers` (供应商主档)
**作用：** 存储供应商的法人/集团信息。
| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **code** | `VARCHAR` | 供应商代码 | Not Null, Unique, Indexed |
| **name** | `VARCHAR` | 供应商法人/集团全称 | Not Null |
| **type** | `VARCHAR` | **【核心】**供应商类型 | e.g., 'Manufacturer', 'Distributor', 'Agent' |
| **...** | ... | 其他集团层面的信息 (如总合同号) | |

#### `supplier_locations` (供应商地点/出货地表)
**作用：** 存储一个供应商法人实体下的所有物理出货地点信息。
| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **supplier_id** | `INTEGER` | 关联到供应商主档 | 外键, 关联 `suppliers.id`, Not Null |
| **loc_name** | `VARCHAR` | 地点名称 (如 "深圳龙华厂区") | Not Null |
| **loc_code** | `VARCHAR` | 地点代码 (可选) | |
| **address** | `VARCHAR` | 详细出货地址 | |
| **contact_person**| `VARCHAR` | 该地点的联系人 | |
| **phone** | `VARCHAR` | 该地点的联系电话 | |
| **is_default** | `BOOLEAN` | 是否为该供应商的默认出货地 | Not Null, Default: False |

#### `supplier_relationships` (供应商关系表)
**作用：** 明确记录“A是B的代理商”这样的关系。
| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **supplier_id**| `INTEGER` | **代理商/分销商**的ID | 外键, 关联 `suppliers.id` |
| **mfg_id** | `INTEGER` | **被代理的制造商**的ID | 外键, 关联 `suppliers.id` |
| **relation_type**| `VARCHAR` | 关系类型 | e.g., '授权代理', '经销商' |

#### `material_suppliers` (物料供应源表)
**作用：** 记录哪个物料可以从哪个供应商的哪个出货地采购，以及相关的商务条款。
| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **material_id**| `INTEGER` | 关联到物料 | 外键, 关联 `materials.id` |
| **sup_loc_id**| `INTEGER` | **关联到供应商出货地** | 外键, 关联 `supplier_locations.id` |
| **sup_part_num**| `VARCHAR` | 供应商那边的料号 | |
| **lead_time_days**| `INTEGER` | 采购提前期（天） | |
| **unit_price** | `DECIMAL` | 采购单价 | |
| **min_order_qty**| `INTEGER` | 最小订单量 (MOQ) | |

##### `sales_orders` (销售订单主表)
**作用：** 存储订单的总体信息，对应“订单头”。
| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **order_num** | `VARCHAR` | 销售订单号 | Not Null, Unique, Indexed |
| **cust_id** | `INTEGER` | 付款客户 | 外键, 关联 `customers.id`, Not Null |
| **ship_to_loc_id**| `INTEGER` | 收货地址 | 外键, 关联 `customer_locations.id`, Not Null |
| **order_date** | `DATE` | 下单日期 | Not Null |
| **status** | `VARCHAR` | 订单状态 | e.g., 'Draft', 'Confirmed', 'In_Production', 'Shipped' |
| **...** | ... | 其他订单头信息 (如: 业务员, 订单总额) | |

##### `sales_order_lines` (销售订单明细表)
**作用：** 存储订单中每一个具体的产品项，对应“订单行”。
| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **order_id** | `INTEGER` | 关联到销售订单主表 | 外键, 关联 `sales_orders.id`, Not Null |
| **line_num** | `INTEGER` | 订单行号 | |
| **product_id**| `INTEGER` | 关联到客户订购的产品 | 外键, 关联 `products.id`, Not Null |
| **quantity** | `DECIMAL` | 订购数量 | Not Null |
| **unit_price**| `DECIMAL` | 单价 | |
| **req_ship_date**| `DATE` | **客户要求的发货日期** | **计划的重要输入** |
| **promised_ship_date** | `DATE`| **我方承诺的发货日期** | **计划的重要输出** |
| **routing_id**| `INTEGER` | **【关键】** 本次生产使用的工艺路线 | 外键, 关联 `routings.id`, 可为空 |

#### `forecast_sets` (预测集主表)
**作用：** 存储每一份独立提交的预测的总体信息。
| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **cust_id** | `INTEGER` | 关联到提供预测的客户 | 外键, 关联 `customers.id`, 可为空 (内部预测) |
| **set_name** | `VARCHAR` | 预测集名称/版本号 | Not Null, e.g., 'Apple_FCST_2025_W35', 'Internal_Q4_Optimistic' |
| **submission_date**| `DATE` | 客户提交/内部发布的日期 | Not Null |
| **period_type**| `VARCHAR` | **【核心】**该预测集的时间粒度 | Not Null, e.g., 'Weekly', 'Monthly', 'Quarterly' |
| **status** | `VARCHAR` | 预测集状态 | e.g., 'Active', 'Archived', 'Superseded' |
| **...** | ... | 其他元数据 (如: 提交人) | |

#### `forecast_lines` (预测明细表)
**【修改】** 原 `forecasts` 表升级为此表。
**作用：** 存储一个预测集中，每个产品在每个周期的具体数量。
| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **set_id** | `INTEGER` | **【核心】** 关联到预测集主表 | 外键, 关联 `forecast_sets.id`, Not Null |
| **product_id**| `INTEGER` | 关联到预测的产品 | 外键, 关联 `products.id`, Not Null |
| **period_start_date** | `DATE` | **【核心】**预测周期的开始日期 | Not Null, e.g., '2025-08-25' (周一) |
| **quantity** | `DECIMAL` | 预测数量 | Not Null |