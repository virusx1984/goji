<!-- __design_draft/01.Data_Modeling.md -->
### **【最终审查版】Goji 产能规划系统 - 最终数据库模型**

**版本:** 1.2
**日期:** 2025-08-04

本文档定义了Goji产能规划系统的核心数据库表结构，涵盖了组织、主数据、生产流程、需求计划以及用户权限等所有关键业务域。所有表均已统一命名规范并添加了审计字段。

---

#### **1. 组织与法人域 (Organization & Legal Domain)**

此域定义了公司的组织层级、法人实体和物理位置。

##### `business_units` (事业部表)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **name** | `VARCHAR` | BU名称 | Not Null, Unique |
| **description**| `VARCHAR` | BU描述 | |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `legal_entities` (公司法人表)
 
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **name** | `VARCHAR` | 公司法人全称 | Not Null, Unique |
| **tax_id** | `VARCHAR` | 统一社会信用代码/税号 | Unique, Indexed |
| **address** | `VARCHAR` | 注册地址 | |
| **legal_rep**| `VARCHAR` | 法定代表人 | |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `factory_clusters` (工厂集群表)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **bu_id** | `INTEGER` | 关联到所属的BU | 外键, 关联 `business_units.id`, Not Null |
| **legal_entity_id**| `INTEGER`| 关联到所属的法人公司 | 外键, 关联 `legal_entities.id`, Not Null |
| **name** | `VARCHAR` | 集群名称 | Not Null, Unique |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `plants` (工厂/厂房表)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **cluster_id**| `INTEGER` | 关联到所属的工厂集群 | 外键, 关联 `factory_clusters.id`, Not Null |
| **name** | `VARCHAR` | 工厂名称 | Not Null |
| **address** | `VARCHAR` | 工厂地址 | |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

---

#### **2. 核心主数据域 (Core Master Data Domain)**

此域定义了与业务交互的外部实体，以及所有生产活动涉及的物品。

##### `customers` (客户主档)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **code** | `VARCHAR` | 客户代码 | Not Null, Unique, Indexed |
| **name** | `VARCHAR` | 客户法人/集团全称 | Not Null |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `customer_locations` (客户地点/交货地表)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **cust_id** | `INTEGER` | 关联到客户主档 | 外键, 关联 `customers.id`, Not Null |
| **loc_name** | `VARCHAR` | 地点名称 | Not Null |
| **loc_code** | `VARCHAR` | 地点代码 (客户方提供) | |
| **address** | `VARCHAR` | 详细交货地址 | |
| **contact_person**| `VARCHAR` | 收货联系人 | |
| **phone** | `VARCHAR` | 联系电话 | |
| **is_default** | `BOOLEAN` | 是否为默认收货地址 | Not Null, Default: False |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `suppliers` (供应商主档)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **code** | `VARCHAR` | 供应商代码 | Not Null, Unique, Indexed |
| **name** | `VARCHAR` | 供应商法人/集团全称 | Not Null |
| **supplier_type**| `VARCHAR` | 供应商类型 | e.g., 'Manufacturer', 'Distributor' |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `supplier_locations` (供应商地点/出货地表)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **supplier_id**| `INTEGER` | 关联到供应商主档 | 外键, 关联 `suppliers.id`, Not Null |
| **loc_name** | `VARCHAR` | 地点名称 | Not Null |
| **loc_code** | `VARCHAR` | 地点代码 (供应商提供) | |
| **address** | `VARCHAR` | 详细出货地址 | |
| **contact_person**| `VARCHAR` | 联系人 | |
| **phone** | `VARCHAR` | 联系电话 | |
| **is_default** | `BOOLEAN` | 是否为默认出货地 | Not Null, Default: False |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `supplier_relationships` (供应商关系表)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **supplier_id**| `INTEGER` | 代理商/子公司的ID | 外键, 关联 `suppliers.id` |
| **mfg_id** | `INTEGER` | 被代理制造商/母公司的ID | 外键, 关联 `suppliers.id` |
| **relation_type**| `VARCHAR` | 关系类型 | e.g., '代理', '集团成员' |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |

##### `products` (产品表)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 厂内唯一主键 | Primary Key |
| **product_status** | `VARCHAR`| 产品状态 | Not Null, e.g., 'PLANNING', 'ACTIVE', 'EOL' |
| **ref_product_id** | `INTEGER`| 参考产品ID (用于规划) | 外键, 自关联到 `products.id`, 可为空 |
| **cust_id** | `INTEGER` | 关联到客户 | 外键, 关联 `customers.id`, Not Null |
| **cust_part_num**| `VARCHAR`| 客户提供的料号 | Not Null, Indexed |
| **cust_ver**| `VARCHAR` | 客户提供的版本号 | Not Null |
| **description**| `VARCHAR` | 产品描述 | |
| **pcs_per_strip**| `INTEGER` | (UOM) 每 strip 包含多少 pcs | |
| **strips_per_panel**|`INTEGER` | (UOM) 每 panel 包含多少 strip | |
| **created_at** | `TIMESTAMP` | 创建时间 | Not Null |
| **updated_at** | `TIMESTAMP` | 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `materials` (物料表)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **part_num** | `VARCHAR` | 物料料号 | Not Null, Unique, Indexed |
| **material_type**| `VARCHAR` | 物料类型 | 'RAW', 'SEMI', 'FINISHED' |
| **name** | `VARCHAR` | 物料名称 | |
| **description**| `VARCHAR` | 物料描述/规格 | |
| **uom** | `VARCHAR` | 基础库存单位 | Not Null |
| **length** | `DECIMAL` | 标准长度 | 可为空 |
| **width** | `DECIMAL` | 标准宽度 | 可为空 |
| **thickness** | `DECIMAL` | 标准厚度 | 可为空 |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `operations` (标准工序表)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **code** | `VARCHAR` | 工序代码 | e.g., 'A001' |
| **name** | `VARCHAR` | 工序名称 | Not Null, Unique |
| **description**| `VARCHAR` | 工序详细描述 | |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `assets` (资产主档表)

**作用:** 作为所有物理资产（设备、模具等）的中央资料库，记录其唯一的资产信息。

| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **asset_group_id**| `INTEGER` | 关联到所属的资产组 | 外键, 关联 `asset_groups.id`, 可为空 |
| **asset_tag**| `VARCHAR` | 资产编号 | Not Null, Unique |
| **serial_num**| `VARCHAR` | 资产序列号 | Unique |
| **model_num** | `VARCHAR` | 资产型号 | |
| **sup_loc_id**| `INTEGER` | 采购供应商地点 | 外键, 关联 `supplier_locations.id` |
| **mfg_id** | `INTEGER` | 品牌制造商 | 外键, 关联 `suppliers.id` |
| **purchase_date**| `DATE` | 采购日期 | |
| **install_date**| `DATE` | 安装日期 | |
| **asset_status** | `VARCHAR` | 资产状态 | e.g., 'Active', 'Maintenance', 'Retired' |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `asset_groups` (资产组主档表)

**作用:** 定义一个由多个物理资产组成的逻辑功能单元（如生产线、曝光机组）。

| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **plant_id** | `INTEGER` | 关联到所属的工厂 | 外键, 关联 `plants.id`, Not Null |
| **name** | `VARCHAR` | 资产组名称 | Not Null, Unique |
| **group_status** | `VARCHAR` | 资产组状态 | e.g., 'Active', 'Inactive' |
| **description**| `VARCHAR` | 资产组描述 | |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `work_centers` (工作中心表)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **plant_id** | `INTEGER` | 关联到所属的工厂 | 外键, 关联 `plants.id`, Not Null |
| **name** | `VARCHAR` | 工作中心名称 | Not Null, Unique |
| **description**| `VARCHAR` | 工作中心描述 | |
| **daily_avail_sec**| `INTEGER` | 每日计划可用时间（秒）| Not Null |
| **oee_pct** | `DECIMAL` | 设备综合效率 | Not Null |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

---

#### **3. 核心关系与流程定义域 (Core Relation & Process Domain)**

此域是系统的核心，定义了“如何制造产品”的详细规则。

##### `work_center_assets` (工作中心资产关联表)

**作用:** 建立“生产调度单元(Work Center)”和“物理资产(Asset)”之间的灵活关系。

| 字段名 (缩写) | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **wc_id** | `INTEGER` | 关联到工作中心 | 外键, 关联 `work_centers.id` |
| **asset_id**| `INTEGER` | 关联到具体资产 | 外键, 关联 `assets.id` |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |

##### `routings` (工艺路线主表)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **routing_status** | `VARCHAR` | 工艺路线状态 | Not Null, e.g., 'PLANNING', 'ACTIVE' |
| **product_id**| `INTEGER` | 关联到产品 | 外键, 关联 `products.id` |
| **plant_id** | `INTEGER` | 此工艺路线所属的工厂 | 外键, 关联 `plants.id` |
| **int_part_num**| `VARCHAR` | 厂内料号 | Not Null, Indexed |
| **int_ver** | `VARCHAR` | 厂内版本 | Not Null |
| **is_default**| `BOOLEAN` | 是否为默认生产版本 | Not Null, Default: False |
| **is_active** | `BOOLEAN` | 此工艺路线是否有效 | Not Null, Default: True |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `routing_operations` (工艺路线工序明细表)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **routing_id**| `INTEGER` | 关联到工艺路线 | 外键, 关联 `routings.id` |
| **operation_id** | `INTEGER` | 关联到标准工序 | 外键, 关联 `operations.id` |
| **step_num** | `INTEGER` | 工序号 | Not Null |
| **layer_def_id** | `INTEGER` | 此工序操作/产出的层别ID | 外键, 关联 `layer_definitions.id`, 可为空 |
| **semi_part_num** | `VARCHAR` | (文本)相关的半成品料号 | 可为空 |
| **notes** | `TEXT` | (文本)工艺备注 | |
| **workpiece_pcs**| `DECIMAL` | 工件PCS数 | |
| **workpiece_len**| `DECIMAL` | 工件长度 | |
| **workpiece_width**| `DECIMAL` | 工件宽度 | |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `layer_definitions` (层别定义主表)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **layer_code** | `VARCHAR` | 层别代码 | Not Null, Unique, Indexed |
| **layer_name** | `VARCHAR` | 层别名称 | |
| **description**| `VARCHAR` | 详细描述 | |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `layer_structures` (叠构关系表)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **product_id**| `INTEGER` | 此结构属于哪个产品 | 外键, 关联 `products.id` |
| **parent_layer_id**| `INTEGER`| 父层级的ID | 外键, 关联 `layer_definitions.id` |
| **child_layer_id** | `INTEGER` | 子层级的ID | 在一个产品内必须唯一 |
| **is_primary_branch**| `BOOLEAN` | 是否为主干分支 | Not Null, Default: False |
| **hierarchy_level**| `INTEGER` | 层级深度 (成品为0) | Not Null |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |

##### `operation_resources` (工序可用资源表)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **routing_op_id**| `INTEGER`| 关联到具体工序步骤 | 外键, 关联 `routing_operations.id` |
| **wc_id** | `INTEGER` | 关联到可用工作中心 | 外键, 关联 `work_centers.id` |
| **setup_time_sec**| `INTEGER` | 准备/换模时间（秒） | Not Null |
| **raw_run_time_val** | `DECIMAL` | 原始测量时间值 | |
| **raw_run_time_uom**| `VARCHAR` | 原始测量单位 | |
| **items_per_raw_uom**| `INTEGER` | UOM换算率 (pcs/UOM) | |
| **run_time_sec_per_pc** | `DECIMAL` | 标准化后的单件时间(秒/pcs) | **规划引擎使用此字段** |
| **pref_level** | `INTEGER` | 优先级 (1=首选) | Not Null |
| **is_active** | `BOOLEAN` | 是否激活此选项 | Not Null |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `bom_items` (工艺物料清单表)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **routing_op_id**| `INTEGER`| 关联到具体工序步骤 | 外键, 关联 `routing_operations.id` |
| **material_id**| `INTEGER` | 关联到消耗的物料 | 外键, 关联 `materials.id` |
| **quantity** | `DECIMAL` | (分子)投入物的数量 | Not Null |
| **uom** | `VARCHAR` | (分子)投入物的单位 | Not Null |
| **base_qty** | `DECIMAL` | (分母)产出品的基准数量 | Not Null, Default: 1 |
| **base_uom** | `VARCHAR` | (分母)产出品的基准单位 | Not Null, Default: 'pcs' |
| **multiplier**| `DECIMAL` | 倍数/系数 | Not Null, Default: 1 |
| **scrap_pct**| `DECIMAL` | 损耗率 (%) | Not Null, Default: 0 |
| **notes** | `VARCHAR`| 关于此物料消耗的特别备注 | 可为空 |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `alternate_materials` (替代物料表)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **bom_item_id**| `INTEGER` | 关联到主物料记录 | 外键, 关联 `bom_items.id` |
| **alt_material_id**| `INTEGER`| 替代料的ID | 外键, 关联 `materials.id` |
| **priority** | `INTEGER` | 优先级 | |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |

##### `material_suppliers` (物料供应源表)

| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **material_id**| `INTEGER` | 关联到物料 | 外键, 关联 `materials.id` |
| **sup_loc_id**| `INTEGER` | 关联到供应商出货地 | 外键, 关联 `supplier_locations.id` |
| **sup_part_num**| `VARCHAR` | 供应商那边的料号 | |
| **lead_time_days**| `INTEGER` | 采购提前期（天） | |
| **unit_price** | `DECIMAL` | 采购单价 | |
| **min_order_qty**| `INTEGER` | 最小订单量 (MOQ) | |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

---

#### **4. 需求与计划域 (Demand & Planning Domain)**

此域是驱动所有生产活动的源头。

##### `sales_orders` (销售订单主表)
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **order_num** | `VARCHAR` | 销售订单号 | Not Null, Unique |
| **cust_id** | `INTEGER` | 付款客户 | 外键, 关联 `customers.id`, Not Null |
| **ship_to_loc_id**| `INTEGER` | 收货地址 | 外键, 关联 `customer_locations.id`, Not Null |
| **order_date** | `DATE` | 下单日期 | Not Null |
| **order_status** | `VARCHAR` | 订单状态 | e.g., 'Confirmed', 'In_Production' |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `sales_order_lines` (销售订单明细表)
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **order_id** | `INTEGER` | 关联到销售订单主表 | 外键, 关联 `sales_orders.id` |
| **line_num** | `INTEGER` | 订单行号 | |
| **product_id**| `INTEGER` | 关联到订购的产品 | 外键, 关联 `products.id` |
| **quantity** | `DECIMAL` | 订购数量 | Not Null |
| **unit_price**| `DECIMAL` | 单价 | |
| **req_ship_date**| `DATE` | 客户要求的发货日期 | |
| **promised_ship_date** | `DATE`| 我方承诺的发货日期 | |
| **routing_id**| `INTEGER` | 本次生产使用的工艺路线 | 外键, 关联 `routings.id` |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `forecast_sets` (预测集主表)
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **cust_id** | `INTEGER` | 关联到提供预测的客户 | 外键, 关联 `customers.id`, 可为空 |
| **set_name** | `VARCHAR` | 预测集名称/版本号 | Not Null |
| **submission_date**| `DATE` | 提交/发布日期 | Not Null |
| **period_type**| `VARCHAR` | 该预测集的时间粒度 | Not Null, e.g., 'Weekly', 'Monthly' |
| **set_status** | `VARCHAR` | 预测集状态 | e.g., 'Active', 'Archived' |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

##### `forecast_lines` (预测明细表)
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **set_id** | `INTEGER` | 关联到预测集主表 | 外键, 关联 `forecast_sets.id` |
| **product_id**| `INTEGER` | 关联到预测的产品 | 外键, 关联 `products.id` |
| **period_start_date** | `DATE` | 预测周期的开始日期 | Not Null |
| **quantity** | `DECIMAL` | 预测数量 | Not Null |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |
| **updated_by_id**| `INTEGER` | 更新用户ID | 外键, 关联 `users.id` |

---

#### **5. 用户与权限域 (User & Permission Domain)**

此域定义了系统的安全和访问控制。

##### `users` (用户表)
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **username** | `VARCHAR` | 用户登录名 | Not Null, Unique |
| **password_hash** | `VARCHAR` | 加密后的密码哈希值 | Not Null |
| **full_name**| `VARCHAR` | 用户姓名 | |
| **email** | `VARCHAR` | 电子邮箱 | Unique |
| **is_active**| `BOOLEAN` | 账户是否激活 | Not Null, Default: True |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |

##### `roles` (角色表)
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **name** | `VARCHAR` | 角色名称 | Not Null, Unique |
| **description**| `VARCHAR` | 角色描述 | |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |

##### `user_roles` (用户角色关联表)
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **user_id** | `INTEGER` | 关联到用户 | 外键, 关联 `users.id` |
| **role_id** | `INTEGER` | 关联到角色 | 外键, 关联 `roles.id` |
| **plant_id** | `INTEGER` | 数据范围：工厂ID | 外键, 关联 `plants.id`, 可为空 |
| **bu_id** | `INTEGER` | 数据范围：BU_ID | 外键, 关联 `business_units.id`, 可为空 |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |

##### `permissions` (权限表)
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **name** | `VARCHAR` | 权限代码 (程序中使用) | Not Null, Unique |
| **description**| `VARCHAR` | 权限描述 (界面显示) | |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |

##### `role_permissions` (角色权限关联表)
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **role_id** | `INTEGER` | 关联到角色 | 外键, 关联 `roles.id` |
| **permission_id**| `INTEGER`| 关联到权限 | 外键, 关联 `permissions.id` |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **created_by_id**| `INTEGER` | 创建用户ID | 外键, 关联 `users.id` |

##### `menus` (菜单表)
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `INTEGER` | 唯一主键 | Primary Key |
| **parent_id**| `INTEGER` | 父菜单ID | 外键, 自关联 `menus.id`, 可为空 |
| **name** | `VARCHAR` | 菜单显示名称 | Not Null |
| **route** | `VARCHAR` | 前端路由路径 | |
| **icon** | `VARCHAR` | 菜单图标 | |
| **order_num**| `INTEGER` | 菜单排序号 | |
| **required_permission_id**| `INTEGER` | 查看此菜单所需的权限ID | 外键, 关联 `permissions.id`, 可为空 |
| **created_at**| `TIMESTAMP`| 创建时间 | Not Null |
| **updated_at**| `TIMESTAMP`| 更新时间 | Not Null |

##### `audit_logs` (操作审计日志表)
| 字段名 | 数据类型 | 说明 | 备注 |
| :--- | :--- | :--- | :--- |
| **id** | `BIGINT` | 唯一主键 | Primary Key |
| **user_id** | `INTEGER` | 执行操作的用户ID | 外键, 关联 `users.id` |
| **action_type**| `VARCHAR` | 操作类型 | e.g., 'CREATE', 'UPDATE', 'DELETE' |
| **table_name** | `VARCHAR` | 被操作的表名 | |
| **record_id** | `INTEGER` | 被操作的记录ID | |
| **before_value**| `JSONB` | 变更前的数据快照 | |
| **after_value** | `JSONB` | 变更后的数据快照 | |
| **ip_address** | `VARCHAR` | 操作者IP地址 | |
| **timestamp** | `TIMESTAMP`| 操作发生的时间 | Not Null, Default: NOW() |